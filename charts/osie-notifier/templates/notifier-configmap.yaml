apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-config" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
data:
  application.yml: |
    logging:
      level:
        root: INFO
    platform:
      api:
        url: {{ required "osie.api.url is required" (tpl .Values.osie.api.url .) }}
    spring:
      rabbitmq:
        addresses: {{ required "rabbitmq.addresses must pe specified." (tpl .Values.rabbitmq.addresses .)}}
        {{- if .Values.rabbitmq.auth.username }}
        username: {{ tpl .Values.rabbitmq.auth.username . }}
        {{- end }}
    {{- if .Values.sentry.dsn }}
    sentry:
      traces-sample-rate: 1.0
      dsn: {{ tpl .Values.sentry.dsn . }}
    {{- end}}
    management:
      health:
        readinessstate:
          enabled: true
        livenessstate:
          enabled: true
      endpoints:
        web:
          exposure:
            include: "health"
      server:
        port: 8081
